<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline' *; script-src 'self'  'unsafe-inline' 'unsafe-eval' *;">
        <meta name="viewport" content="width=device-width, user-scalable=no" />
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/css/navbar.css">
        <link rel="stylesheet" href="assets/css/dog.css">
        <link rel="stylesheet" href="assets/css/font/fonts.css">
    </head>
    <body>
        <div id="page-content">
            <div class="container">
                <br>
                <h3>จำนวนสุนัข <span id="dogcount"></span> ตัว :</h3><br>
                <form id="dogform" method="POST">
                    <div id="doglist" class="list-group"></div>
                    <input type="hidden" name="token" id="token" />
                    <br>
                    <a href="dog_add.html?newDog=1" style="text-decoration: none">
                        <button id="add" type="button" class="btn btn-default btn-block" style="background-color: #ac2925; color: white;font-size: 0.8em">เพิ่มสุนัข + </button>
                    </a>
                    <div id="changebt"><button id="delete" class="btn btn-default btn-block" type="button" style="background-color: #ac2925; color: white;font-size: 0.8em">ลบสุนัข - </button></div>
                    <br>
                </form>
            </div>
            <!-- /.container -->

        </div>
        <script src="cordova.js"></script>
        <script src="assets/js/jquery.js"></script>
        <script src="assets/js/jquery.transit.min.js"></script>
        <script src="assets/js/base.js"></script>
        <script src="assets/js/functions.js"></script>
        <script src="assets/js/autoload.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script>
            $(function () {
                displayName();
                setMenu("nav-user");
                setMenu("nav-doglist");
                disableBackButton();
                
                if (dogdata.length > 0) {
                    for (var i = 0; i < dogdata.length; i++) {
                        var thisdog = dogdata[i];
                        $("#doglist").append('<a href="dogprofile.html?dogindex=' + i + '" id="doglink" class="list-group-item">' + ' ' + '<input hidden type="checkbox" name="dog_id" value="' + thisdog.dog_id + '"/>' + ' ' + thisdog.dog_name + '<span class="glyphicon glyphicon-menu-right" style="float:right"></span>' + '</a>');
                    }
                }
                
                $("#token").val(window.localStorage.getItem("token"));
                setTitle("รายชื่อสุนัขของ " + userdata.firstname);
                $("#dogcount").html(dogdata.length);

                $("#delete").on("click", function (e) {
                    $("input[name=dog_id]").removeAttr("hidden");
                    $("#doglink").removeAttr("href");
                    $("#delete").hide();
                    $("#add").hide();
                    $("#changebt").html('<input class="btn btn-default btn-block" type="submit" style="background-color: #ac2925; color: white ;font-size: 0.8em" value="บันทึกข้อมูล" />');
                });

                $("#dogform").submit(function (e) {
                    createLoader();
                    var cf = confirm("ยืนยันการลบข้อมูลสุนัข");
                    if (cf == true) {
                        var result = true;
                        var dog_id = new Array();
                        $("input:checked").each(function () {
                            dog_id.push($(this).val());
                        });
                        for (var i = 0; i < dog_id.length; i++) {
                            console.log(dog_id[i]);
                            $.ajax({
                                type: 'POST',
                                url: 'https://dogblooddonor.in.th/api/dog_remove.php',
                                dataType: 'json',
                                data: {"token": token, "dog_id": dog_id[i]}, //{"dogform": $('input:checkbox:checked').val()},
                                success: function (data) {
                                    if (data.result != 1) {
                                        result = false;
                                    }
                                }
                            });
                        }
                        if (result) {
                            alert("ลบข้อมูลสุนัขออกจากระบบเรียบร้อยแล้วค่ะ");
                            updateData();
                            document.location = "dog_list.html";
                        } else {
                            alert("ลบสุนัขไม่สำเร็จค่ะ");
                            removeLoader();
                        }
                    }
                    e.preventDefault();
                    return false;
                });
                
            });

        </script>
    </body>
</html>
